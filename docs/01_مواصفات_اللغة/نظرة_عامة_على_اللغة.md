# مواصفات لغة باء
# B (باء) Language Specification

## 1. أمثلة النحو الأساسي

### 1.1 توجيهات المعالج المسبق

تدعم باء خطوة معالج مسبق تتعامل مع التوجيهات التي تبدأ بـ `#` قبل التحليل اللفظي. هذه التوجيهات تسمح بتضمين الملفات وتعريف الماكرو والتجميع الشرطي.

#### 1.1.1 تضمين الملفات

* **`#تضمين` (Include):** يُستخدم لتضمين محتوى ملفات أخرى. - *[منفذ]*
  * `#تضمين "مسار/ملف/نسبي.ب"`: يتضمن ملف نسبي لمسار الملف الحالي.
  * `#تضمين <مكتبة_قياسية>`: يتضمن ملف موجود في مسارات تضمين المكتبة القياسية.

    ```baa
    #تضمين "my_definitions.b" // تضمين ملف محلي
    #تضمين <standard_io>      // تضمين مكتبة قياسية
    ```

#### 1.1.2 تعريفات الماكرو

* **`#تعريف` (Define):** يعرف ماكرو معالج مسبق. - *[منفذ]*
  * **ماكروات شبيهة بالكائن:** تستبدل معرف بتسلسل رموز.

      ```baa
        #تعريف PI 3.14159
        #تعريف GREETING "مرحباً بالعالم"
        عدد_حقيقي س = PI.
        اطبع(GREETING).
      ```

  * **ماكروات شبيهة بالدالة:** تعرف ماكروات تأخذ معاملات.

      ```baa
        #تعريف MAX(a, b) ((a) > (b) ? (a) : (b))
        عدد_صحيح الأكبر = MAX(10, 20). // توسع إلى ((10) > (20) ? (10) : (20))

        #تعريف ADD(x, y) (x + y)
        عدد_صحيح المجموع = ADD(5, 3). // توسع إلى (5 + 3)
      ```

  * **عملية التحويل إلى سلسلة (`#`):** تحول معامل ماكرو إلى قيمة حرفية نصية. - *[منفذ]*

      ```baa
        #تعريف STRINGIFY(val) #val
        اطبع(STRINGIFY(مرحبا)). // توسع إلى اطبع("مرحبا").
        اطبع(STRINGIFY(123)).   // توسع إلى اطبع("123").
      ```

  * **عملية لصق الرموز (`##`):** تربط رمزين. - *[منفذ]*

      ```baa
        #تعريف CONCAT(a, b) a##b
        عدد_صحيح CONCAT(var, Name) = 10. // يعلن عدد_صحيح varName = 10.
      ```

#### 1.1.3 التجميع الشرطي

توجيهات لتجميع أجزاء من الكود بناءً على شروط. - *[منفذ]*

* **`#إذا` (If):** يجمع الكود التالي إذا كان التعبير يقيم إلى صحيح (غير صفر). - *[منفذ]*

    ```baa
    #تعريف DEBUG_MODE 1
    #إذا DEBUG_MODE
        اطبع("وضع التصحيح مفعل.").
    #نهاية_إذا
    ```

* **`#إذا_عرف` (If defined):** يجمع الكود التالي إذا كان الماكرو معرف. - *[منفذ]*

    ```baa
    #تعريف MY_FEATURE
    #إذا_عرف MY_FEATURE
        اطبع("ميزة MY_FEATURE مفعلة.").
    #نهاية_إذا
    ```

### 1.2 إنهاء الجمل

الجمل تُنهى بنقطة (`.`) بدلاً من الفاصلة المنقوطة.

```baa
اطبع("مرحبا").    // صحيح
اطبع("مرحبا");    // خطأ
```

### 1.3 مثال إعلان الدالة

```baa
// الدالة الرئيسية (نقطة الدخول)
فراغ رئيسية() {
    // جسم الدالة
}

// دالة مع معامل عدد صحيح وقيمة إرجاع
عدد_صحيح مربع(عدد_صحيح س) {
    إرجع س * س.
}
```

### 1.4 مثال إعلان المتغير

المتغيرات تُعلن باستخدام نحو نمط C.

```baa
// إعلان عدد صحيح باسم 'counter'
عدد_صحيح counter.

// إعلان وتهيئة عدد حقيقي باسم 'price'
عدد_حقيقي price = 10.5.

// إعلان منطقي ثابت
ثابت منطقي FLAG = صحيح.
```

### 1.5 مثال التحكم في التدفق

هياكل التحكم تستخدم كلمات مفتاحية عربية وإنهاء بالنقطة.

```baa
// جملة إذا
إذا (س > 0) {
    اطبع("موجب").
} وإلا {
    اطبع("سالب").
}

// حلقة طالما
طالما (س < 10) {
    اطبع(س).
    س = س + 1.
}
```

## 2. الهيكل اللفظي

يصف هذا القسم لبنات البناء منخفضة المستوى لبرامج باء **بعد** المعالجة المسبقة. المعالج المسبق لباء يقبل ملفات مصدر بـ UTF-8 (افتراضي إذا لم يكن BOM موجود) أو UTF-16LE. الإخراج المعالج من المعالج المسبق، والذي يتم تغذيته للمحلل اللفظي، مرمز بـ **UTF-16LE**.

### 2.1 التعليقات

باء تدعم تعليقات نمط C/C++ القياسي، وكذلك تعليقات التوثيق:

* **سطر واحد:** يبدأ بـ `//` ويستمر حتى نهاية السطر. - *[منفذ]*
* **متعدد الأسطر:** يبدأ بـ `/*` وينتهي بـ `*/`. - *[منفذ]*
* **تعليقات التوثيق:** تبدأ بـ `/**` وتنتهي بـ `*/`. - *[منفذ]*

```baa
// هذا تعليق سطر واحد.
/*
  هذا تعليق
  متعدد الأسطر.
*/
/**
 * هذا تعليق توثيقي.
 * يمكن أن يمتد عبر عدة أسطر.
 */
```

### 2.2 المعرفات

المعرفات هي أسماء تُستخدم للمتغيرات والدوال والأنواع وغيرها.

* **الحروف المسموحة:** حروف عربية، حروف إنجليزية (`a-z`, `A-Z`)، أرقام عربية-هندية (`٠-٩`)، أرقام ASCII (`0-9`)، والشرطة السفلية (`_`).
* **الحرف البادئ:** يجب أن يبدأ بحرف (عربي أو إنجليزي) أو شرطة سفلية.
* **حساسية الحالة:** المعرفات حساسة للحالة.

```baa
// أمثلة صحيحة
حرف الإسم_الأول.
عدد_صحيح _temporaryValue.
عدد_صحيح قيمة_رقمية1.
حرف القيمة٢.

// أمثلة خاطئة
// عدد_صحيح 1stValue. // لا يمكن البدء برقم
// حرف قيمة-خاصة.     // الشرطة غير مسموحة
// عدد_صحيح إذا.      // الكلمة المفتاحية لا يمكن أن تكون معرف
```

### 2.3 الكلمات المفتاحية

الكلمات المفتاحية هي كلمات محجوزة لها معنى خاص في لغة باء ولا يمكن استخدامها كمعرفات.

* **الإعلانات:** `ثابت` (`const`), `مستقر` (`static`), `خارجي` (`extern`), `مضمن` (`inline`)
* **التحكم في التدفق:** `إذا`, `وإلا`, `طالما`, `إرجع`, `توقف` (`break`), `استمر` (`continue`)
* **الأنواع:** `عدد_صحيح`, `عدد_حقيقي`, `حرف`, `منطقي`, `فراغ`
* **القيم المنطقية الحرفية:** `صحيح`, `خطأ`

### 2.4 القيم الحرفية

القيم الحرفية تمثل قيم ثابتة في الكود المصدري.

* **القيم الحرفية للأعداد الصحيحة (`عدد_صحيح`):** تمثل أعداد كاملة.
  * **عشري:** تسلسلات من الأرقام الغربية (`0`-`9`) و/أو الأرقام العربية-الهندية (`٠`-`٩`).
    * أمثلة: `123`, `٠`, `٤٢`, `1٠2`
  * **سادس عشري:** يجب أن تبدأ بـ `0x` أو `0X`، متبوعة بأرقام سادس عشري.
    * أمثلة: `0xFF`, `0x1a`, `0XDEADBEEF`
  * **ثنائي:** يجب أن تبدأ بـ `0b` أو `0B`، متبوعة بأرقام ثنائية.
    * أمثلة: `0b1010`, `0B11001`

* **القيم الحرفية للأعداد العشرية (`عدد_حقيقي`):**
  * **تمثيل عشري:** أرقام مع نقطة عشرية (`.` أو `٫`).
    * أمثلة: `3.14`, `٠٫١٢٣`
  * **الترميز العلمي:** يُدخل بـ `أ`، متبوع بعلامة اختيارية (`+`/`-`) وأرقام.
    * أمثلة: `1.23أ4`, `10أ-2`, `٠٫٥أ+٣`

* **القيم المنطقية الحرفية (`منطقي`):**
  * `صحيح` (true)
  * `خطأ` (false)

* **القيم الحرفية للحروف (`حرف`):** تمثل حروف مفردة محاطة بعلامات اقتباس مفردة (`'`).
  * `'a'`, `'أ'`, `'#'`, `'١'`
  * **تسلسلات الهروب العربية:**
    * `\س` (سطر جديد), `\م` (تاب), `\\` (شرطة مائلة عكسية), `\'` (اقتباس مفرد)
    * `\يXXXX` (هروب Unicode), `\هـHH` (هروب بايت سادس عشري)

* **القيم الحرفية النصية:** تمثل تسلسلات حروف محاطة بعلامات اقتباس مزدوجة (`"`).
  * `"مرحباً"`, `"Hello, World!"`
  * **تسلسلات هروب عربية:** نفس الحروف الحرفية
  * **سلاسل متعددة الأسطر:** محاطة بثلاث علامات اقتباس مزدوجة (`"""`)
  * **سلاسل خام:** مبدوءة بـ `خ` (لا تعالج تسلسلات الهروب)

## 3. الأنواع

باء لها نظام أنواع ثابت مبني على C، مع أسماء عربية للأنواع المدمجة.

### 3.1 الأنواع الأساسية

| الاسم العربي | المكافئ الإنجليزي | الوصف | الحجم | الحالة |
| ----------- | --------------- | ----- | ---- | ----- |
| `عدد_صحيح` | `int` | عدد صحيح موقع | 32-بت | منفذ |
| `عدد_حقيقي` | `float` | عدد عشري | 32-بت | منفذ |
| `حرف` | `char` | حرف/سلسلة | 16-بت | منفذ |
| `منطقي` | `bool` | منطقي (`صحيح`/`خطأ`) | 8-بت | منفذ |
| `فراغ` | `void` | لا يمثل قيمة | غ/م | منفذ |

### 3.2 الأنواع المشتقة

| الاسم العربي | المكافئ الإنجليزي | الوصف | الحالة |
| ----------- | --------------- | ----- | ----- |
| `مصفوفة` | array | مجموعة مرتبة من العناصر | جزئي |
| `مؤشر` | pointer | عنوان متغير | مخطط |
| `بنية` | struct | مجموعة أعضاء مسماة | مخطط |
| `اتحاد` | union | ذاكرة مشتركة للأعضاء | مخطط |
| `تعداد` | enum | نوع تعداد | مخطط |

## 4. الإعلانات

الإعلانات تدخل أسماء (معرفات) جديدة في نطاق.

### 4.1 إعلانات المتغيرات

المتغيرات تخزن قيم يمكن أن تتغير.

* **النحو:** `type identifier ('=' initializer_expression)? '.'`
* **التهيئة:** اختيارية. إذا أُهملت، القيمة الافتراضية تعتمد على النطاق.
* **الثوابت:** استخدم كلمة `ثابت` المفتاحية قبل النوع لإعلان ثابت لا يمكن تغيير قيمته بعد التهيئة.

```baa
عدد_صحيح counter.             // متغير
عدد_حقيقي price = 10.5.        // متغير، مهيأ
ثابت منطقي FLAG = صحيح.       // ثابت، يجب تهيئته
```

### 4.2 إعلانات الدوال

الدوال تعرف كتل كود قابلة لإعادة الاستخدام.

* **النحو:** `return_type? identifier '(' parameter_list? ')' '{' statement* '}'`
* **نوع الإرجاع:** محدد *قبل* معرف الدالة. إذا أُهمل، افتراضي إلى `فراغ` (void).
* **المعاملات:** قائمة مفصولة بفواصل من `type identifier`.
* **نقطة الدخول:** البرنامج يجب أن يحتوي على دالة مسماة `رئيسية`.

```baa
// دالة بلا معاملات، إرجاع فراغ ضمني
فراغ print_hello() {
    اطبع("مرحبا!").
}

// دالة مع معاملات ونوع إرجاع صريح
عدد_صحيح أضف(عدد_صحيح a, عدد_صحيح b) {
    إرجع a + b.
}
```

## 5. أولوية العمليات وترابطها

الجدول التالي يلخص أولوية العمليات (الأعلى أولاً) والترابط.

| مستوى الأولوية | العمليات | الترابط | الملاحظات | الحالة |
| -------------- | -------- | ------- | -------- | ----- |
| الأعلى (أولي) | `()` `[]` `::` `->` | يسار إلى يمين | تجميع، فهرسة، وصول عضو | منفذ/جزئي |
| (لاحق) | `++` `--` | يسار إلى يمين | زيادة/إنقاص لاحق | منفذ |
| (أحادي) | `++` `--` | يمين إلى يسار | زيادة/إنقاص بادئ | منفذ |
| | `+` `-` (أحادي) | يمين إلى يسار | زائد/ناقص أحادي | منفذ |
| | `!` `~` | يمين إلى يسار | ليس منطقي، ليس بتي | منفذ/جزئي |
| (عامل) | `*` `/` `%` | يسار إلى يمين | ضربي | منفذ |
| (حد) | `+` `-` (ثنائي) | يسار إلى يمين | جمعي | منفذ |
| (مقارنة) | `<` `>` `<=` `>=` | يسار إلى يمين | علائقي | منفذ |
| (مساواة) | `==` `!=` | يسار إلى يمين | مساواة | منفذ |
| (منطقي و) | `&&` | يسار إلى يمين | و منطقي | منفذ |
| (منطقي أو) | `||` | يسار إلى يمين | أو منطقي | منفذ |
| الأدنى (تعيين) | `=` `+=` `-=` إلخ. | يمين إلى يسار | تعيين | منفذ |

## 6. الجمل

الجمل هي وحدات التنفيذ. تُنهى بنقطة (`.`).

### 6.1 جمل التعبير

تعبير متبوع بنقطة هو جملة. التعبير يُقيم لآثاره الجانبية.

```baa
counter++.             // زيادة counter
add(5, 3).             // استدعاء دالة (النتيجة مُهملة)
x = y + 1.             // تعيين
```

### 6.2 جمل الكتلة

تسلسل من صفر أو أكثر من الجمل محاط بأقواس معقوفة `{}`. يعرف نطاق كتلة.

```baa
{
    عدد_صحيح temp = x.
    x = y.
    y = temp.
}
```

### 6.3 الجمل الشرطية (`if`/`else`)

تنفذ جمل بناءً على شرط.

* **النحو:** `إذا '(' expression ')' statement_or_block ( وإلا statement_or_block )?`

```baa
إذا (x > 0) {
    اطبع("موجب").
}

إذا (y == 0)
    اطبع("صفر").
وإلا {
    اطبع("غير صفر").
}
```

### 6.4 جمل التكرار (الحلقات)

#### 6.4.1 حلقة `while`

تكرر جملة/كتلة طالما الشرط صحيح.

* **النحو:** `طالما '(' expression ')' statement_or_block`

```baa
عدد_صحيح i = 0.
طالما (i < 5) {
    اطبع(i).
    i++.
}
```

#### 6.4.2 حلقة `for`

توفر تهيئة وشرط وتعبيرات بعد التكرار للتحكم في الحلقة.

* **النحو:** `لكل '(' init_expr? ';' condition_expr? ';' incr_expr? ')' statement_or_block`

```baa
لكل (عدد_صحيح i = 0; i < 10; i++) {
    اطبع(i).
}
```

### 6.5 جمل القفز

#### 6.5.1 جملة `return`

تخرج من الدالة الحالية، اختيارياً ترجع قيمة.

* **النحو:** `إرجع (expression)? '.'`

#### 6.5.2 جملة `break`

تخرج من الحلقة أو جملة `switch` المحيطة الأعمق.

* **النحو:** `توقف '.'`

#### 6.5.3 جملة `continue`

تتجاوز باقي التكرار الحالي وتتقدم للتكرار التالي.

* **النحو:** `استمر '.'`

## 7. قواعد النطاق

باء تستخدم نطاق معجمي، مشابه لـ C. النطاق يحدد رؤية المعرفات.

* **النطاق العالمي:** الإعلانات خارج أي دالة مرئية عموماً من نقطة إعلانها.
* **نطاق الدالة:** المعاملات والمتغيرات المعلنة داخل دالة مرئية من نقطة إعلانها.
* **نطاق الكتلة:** المتغيرات المعلنة داخل كتلة مرئية فقط من نقطة إعلانها.
* **التظليل:** إعلان في نطاق داخلي يمكن أن *يظلل* إعلان بنفس الاسم من نطاق خارجي.

```baa
عدد_صحيح global_var = 10. // نطاق عالمي

test(عدد_صحيح param) { // نطاق دالة يبدأ
    عدد_صحيح func_var = param + global_var. // يمكن الوصول للعالمي والمعامل

    إذا (func_var > 20) { // نطاق كتلة يبدأ
        عدد_صحيح block_var = 5.
        عدد_صحيح param = 0. // يظلل معامل الدالة 'param'
        اطبع(block_var + param). // يصل لـ block_var والـ param *المظلل* (0)
    } // نطاق الكتلة ينتهي

    اطبع(param). // يصل لمعامل الدالة *الأصلي* 'param'
} // نطاق الدالة ينتهي
```

## 8. هيكل البرنامج

### 8.1 هيكل البرنامج الأساسي

كل برنامج قابل للتنفيذ يجب أن يحتوي على دالة رئيسية (`رئيسية`) تخدم كنقطة الدخول.

```baa
// مثال برنامج بسيط بلغة باء
عدد_صحيح رئيسية() {
    اطبع("مرحباً بالعالم!").
    إرجع 0. // عرفياً إرجاع 0 عند النجاح
}
```

### 8.2 امتداد الملف

ملفات كود باء المصدري عادة تستخدم امتداد `.ب`.

```baa
  برنامج.ب
  my_module.ب
```

## 9. اصطلاحات التسمية

* استخدم أسماء واضحة ووصفية بالعربية أو الإنجليزية.
* اتبع حالة متسقة (مثل `snake_case` أو `camelCase`).
* تجنب الأسماء القصيرة جداً أو الغامضة.

---

**ملاحظة:** هذا التوثيق متوفر أيضاً [بالإنجليزية](../language.md).