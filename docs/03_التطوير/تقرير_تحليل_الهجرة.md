# تقرير تحليل هجرة موقع الأخطاء

**تاريخ التوليد:** د:\My Dev Life\Software Dev\Baa  
**إجمالي مواقع الأخطاء:** 245

## ملخص حسب الفئة

- **directive:** 79 موقع
- **expression:** 15 موقع
- **file:** 16 موقع
- **syntax:** 135 موقع

## ملخص حسب الملف

- **preprocessor.c:** 18 موقع
- **preprocessor_core.c:** 16 موقع
- **preprocessor_directives.c:** 79 موقع
- **preprocessor_expansion.c:** 44 موقع
- **preprocessor_expr_eval.c:** 15 موقع
- **preprocessor_line_processing.c:** 30 موقع
- **preprocessor_utils.c:** 43 موقع

## التفصيل الشامل

### preprocessor.c (18 موقع)

**السطر 32:** `legacy_error`
- **الدالة:** report_unterminated_conditional
- **الرسالة:** وسيطات غير صالحة تم تمريرها إلى المعالج المسبق (المصدر أو اسم المصدر أو مؤشر رسالة الخطأ هو NULL)....
- **الفئة:** syntax
- **الكود المقترح:** PP_ERROR_SYNTAX_BASE + ?
- **السياق:** `*error_message = format_preprocessor_error_at_location(&early_error_loc, L"وسيطا...`

**السطر 32:** `error_assignment`
- **الدالة:** report_unterminated_conditional
- **الرسالة:** وسيطات غير صالحة تم تمريرها إلى المعالج المسبق (المصدر أو اسم المصدر أو مؤشر رسالة الخطأ هو NULL)....
- **الفئة:** syntax
- **الكود المقترح:** PP_ERROR_SYNTAX_BASE + ?
- **السياق:** `*error_message = format_preprocessor_error_at_location(&early_error_loc, L"وسيطا...`

### preprocessor_directives.c (79 موقع)

**السطر 82:** `legacy_error`
- **الدالة:** handle_preprocessor_directive
- **الرسالة:** تنسيق #إذا غير صالح: التعبير مفقود....
- **الفئة:** directive
- **الكود المقترح:** PP_ERROR_DIRECTIVE_BASE + 2
- **السياق:** `*error_message = format_preprocessor_error_at_location(&directive_loc, L"تنسيق #...`

### preprocessor_expansion.c (44 موقع)

**السطر 58:** `legacy_error`
- **الدالة:** stringify_argument
- **الرسالة:** فشل في تخصيص ذاكرة مؤقتة لتسلسل الوسيطة....
- **الفئة:** syntax
- **الكود المقترح:** PP_ERROR_SYNTAX_BASE + ?
- **السياق:** `*error_message = format_preprocessor_error_at_location(&error_loc, L"فشل في تخصي...`

## توصيات الهجرة

### ملفات الأولوية العليا (الأسبوع 2-3)

- **preprocessor_directives.c:** 79 موقع - وظائف أساسية
- **preprocessor_expansion.c:** 44 موقع - وظائف أساسية
- **preprocessor_expr_eval.c:** 15 موقع - وظائف أساسية

### ملفات الأولوية المتوسطة (الأسبوع 4)

- **preprocessor_line_processing.c:** 30 موقع - وظائف داعمة
- **preprocessor_core.c:** 16 موقع - وظائف داعمة

## خطة الهجرة

### المرحلة الأولى: أخطاء التوجيهات

1. **preprocessor_directives.c**: تحديث جميع رسائل أخطاء التوجيهات
   - تحديث رسائل `#إذا` و `#إذا_عرف` و `#إذا_لم_يعرف`
   - تحديث رسائل `#تضمين` و `#تعريف` و `#الغاء_تعريف`
   - معالجة الأخطاء غير المعروفة

### المرحلة الثانية: أخطاء التوسع

2. **preprocessor_expansion.c**: تحديث معالجة أخطاء توسع الماكرو
   - أخطاء stringify_argument
   - أخطاء substitute_macro_body
   - أخطاء معالجة المعاملات

### المرحلة الثالثة: أخطاء التعبيرات

3. **preprocessor_expr_eval.c**: تحديث تقييم التعبيرات
   - أخطاء تهيئة المخزن
   - أخطاء تحويل التعبيرات
   - أخطاء تجاوز الحدود

### المرحلة الرابعة: المرافق والأدوات

4. **preprocessor_utils.c**: تحديث الأدوات المساعدة
   - أخطاء قراءة الملفات
   - أخطاء تحويل الترميز
   - أخطاء إدارة الذاكرة

## إرشادات التنفيذ

### تصنيف الأخطاء

```c
// تصنيف أكواد الأخطاء المقترح
#define PP_ERROR_DIRECTIVE_BASE   1000
#define PP_ERROR_SYNTAX_BASE      2000
#define PP_ERROR_EXPRESSION_BASE  3000
#define PP_ERROR_FILE_BASE        4000
```

### نموذج رسالة الخطأ

```c
// نموذج للرسائل الجديدة
typedef struct {
    int error_code;
    const wchar_t* arabic_message;
    const wchar_t* english_message;
    const wchar_t* suggestion;
} BaaErrorInfo;
```

### مثال التحديث

```c
// قبل التحديث
*error_message = format_preprocessor_error_at_location(&directive_loc, 
    L"تنسيق #إذا غير صالح: التعبير مفقود....");

// بعد التحديث  
report_structured_error(PP_ERROR_DIRECTIVE_INVALID_IF, &directive_loc,
    L"تنسيق #إذا غير صالح: التعبير مفقود",
    L"Invalid #if format: expression missing",
    L"تأكد من وجود تعبير صحيح بعد #إذا");
```

## معايير النجاح

- [ ] تحديث جميع مواقع الأخطاء (245 موقع)
- [ ] اختبار رسائل الخطأ العربية والإنجليزية
- [ ] توحيد تنسيق رسائل الخطأ
- [ ] إضافة اقتراحات للحلول
- [ ] توثيق نظام الأخطاء الجديد

## الجدول الزمني

| المرحلة | المدة | الملفات المستهدفة | عدد المواقع |
|---------|-------|------------------|--------------|
| 1 | أسبوع 1 | preprocessor_directives.c | 79 |
| 2 | أسبوع 2 | preprocessor_expansion.c | 44 |
| 3 | أسبوع 3 | preprocessor_expr_eval.c | 15 |
| 4 | أسبوع 4 | الباقي | 107 |

---

**هذا التقرير جزء من مبادرة تحسين جودة رسائل الخطأ في مترجم لغة باء لتوفير تجربة تطوير أفضل للمطورين العرب.**

*آخر تحديث: 2025-01-09*
